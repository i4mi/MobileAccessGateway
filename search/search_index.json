{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Mobile Access Gateway","text":"<p>The Mobile Access Gateway is an implementation based on the CH EPR mHealth implementation guide. It provides a FHIR Gateway supporting the mobile IHE server actors and translates them to the IHE XDS/HL7v3 transactions.</p> <p>It uses IPF and HAPI-FHIR.</p> <p>You can read more about the features, the endpoints or the changes. A more complete description of the transactions needed for the EPR integration of primary systems is also available.</p> <p>See also the website or github repo for further information. </p>"},{"location":"changelog/","title":"Changelog","text":""},{"location":"changelog/#20241126-v100","title":"2024/11/26 v1.0.0","text":"<ul> <li>Fixed an NPE in the assertion route</li> <li>Improved mapping between XDS XON and FHIR Organization 165</li> <li>Capability statement validation issues #177</li> <li>Add CH PIXm ITI-83 constraints for sourceIdentifier and targetSystem #170</li> <li>Add support for 401 error code #182</li> <li>Allow using the EPR-SPID as Patient id</li> </ul>"},{"location":"changelog/#20240515-v070","title":"2024/05/15 v070","text":"<ul> <li>support for multiple IDP's 128</li> <li>reenable $find-medication-list</li> <li>use IdP also for patient access in web app</li> </ul>"},{"location":"changelog/#20240508-v064","title":"2024/05/08 v064","text":"<ul> <li>Added OAuth URLs to the CapabilityStatement #135</li> <li>Implemented PPQm routes #126</li> <li>Upgraded to IPF 4.8.0</li> <li>Removed dependency on IHE-Europe STS simulator</li> <li>Support for email in real case scenario with invalid contact infos #138</li> <li>Added missing document entry attributes</li> <li>Certificate can be injected by environment variables </li> <li>Fixed coding system OIDs of document author and uploader role codes</li> </ul>"},{"location":"changelog/#20240208-v062","title":"2024/02/08 v062","text":"<ul> <li><code>docker pull europe-west6-docker.pkg.dev/ahdis-ch/ahdis/mag:v062</code></li> <li>Updated documentation on https://i4mi.github.io/MobileAccessGateway/   for containers #132</li> </ul>"},{"location":"changelog/#older-releases","title":"Older releases","text":"<p>For older releases see github tags</p>"},{"location":"docker/","title":"mobile access container","text":"<p>you can download the mobile access gateway as a docker container:</p> <pre><code>docker pull europe-west6-docker.pkg.dev/ahdis-ch/ahdis/mag:v062\n</code></pre>"},{"location":"docker/#configurable-base-image","title":"Configurable base image:","text":"<p>run from the cloned mobile access gateway:</p> <pre><code>docker run -d -it --name mag -p 9090:9090 -v /Users/oegger/Documents/github/MobileAccessGateway/example-playground:/config/ europe-west6-docker.pkg.dev/ahdis-ch/ahdis/mag:v062\ndocker logs --follow mag\n</code></pre> <p>Server endpoint will then be accessible at http://localhost:9090/mag/fhir/metadata</p> <p>You can check for example a PIXm query against the EPD playground:</p> <pre><code>http://localhost:9090/mag/fhir/Patient/$ihe-pix?sourceIdentifier=urn%3Aoid%3A2.16.756.5.30.1.127.3.10.3%7C761337615395845832&amp;targetSystem=urn%3Aoid%3A1.1.1.99.1&amp;targetSystem=urn%3Aoid%3A2.16.756.5.30.1.127.3.10.3\n</code></pre> <p>The mobile access gateway supports also a GUI which is accessible at http://localhost:9090/mag/#/.</p>"},{"location":"docker/#live-and-readiness-checks","title":"Live and Readiness checks","text":"<p>To check if the container is live and ready you can check the health:</p> <pre><code>GET http://localhost:9090/mag/actuator/health HTTP/1.1\nAccept: application/vnd.spring-boot.actuator.v3+json\n\nHTTP/1.1 200\nContent-Type: application/vnd.spring-boot.actuator.v3+json\nTransfer-Encoding: chunked\nDate: Thu, 02 Feb 2023 15:55:12 GMT\nVia: 1.1 google\nAlt-Svc: h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000\nConnection: close\n\n{\n  \"status\": \"UP\"\n}\n</code></pre>"},{"location":"endpoints/","title":"Endpoints","text":"<p>Here are the endpoints exposed by the Mobile Access Gateway.</p> Transaction URL ITI-65 instance/fhir/ ITI-66 instance/fhir/List ITI-67 instance/fhir/DocumentReference ITI-68 instance/camel/xdsretrieve ITI-71 instance/camel/authorize ITI-71 instance/camel/token ITI-78 instance/fhir/Patient ITI-83 instance/fhir/Patient/$ihe-pix ITI-93 ITI-104 instance/fhir/Patient CH:PHARM-5 instance/fhir/DocumentReference/${operation-name} Get X-User Assertion instance/camel/assertion CH:PPQ3 instance/fhir CH:PPQ4 instance/fhir CH:PPQ5 instance/fhir"},{"location":"features/","title":"Features","text":"<p>The Mobile Access Gateway provides translation from REST to SOAP variants of IHE transaction:</p> IHE-Profile ITI Transaction Name IHE Actor Implemented in the Gateway with following actors Transaction PDQm ITI-78 Mobile Patient Demographics Query Patient Demographics Supplier PDQv3 Patient Demographics Consumer ITI-47 PIXm ITI-83 Mobile Patient Identifier Cross-reference Query Patient Identity Manager PIX V3 Patient Identifier Cross-reference Consumer ITI-45 PIXm ITI-104 Patient Identity Feed FHIR Patient Identity Manager PIX V3 Patient Identity Source ITI-44 MHD ITI-65 Provide Document Bundle Document Recipient XDS Document Source, X-Service-User ITI-41 MHD ITI-66 Find Document Lists Document Responder XDS Document Consumer, X-Service-User ITI-18 MHD ITI-67 Find Document References Document Responder XDS Document Consumer, X-Service-User ITI-18 MHD ITI-68 Retrieve Document Document Responder XDS Document Consumer, X-Service-User ITI-43 IUA ITI-71 Get Access Token IUA Authorization Server X-Service-User Authenticate User / Get X-User Assertion CMPD CH:PHARM-5 Query Pharmacy Documents Community Pharmacy Manager Querying Actor CH:PHARM-1 PPQm CH:PPQ3 Mobile Privacy Policy Feed Policy Repository Policy Source CH:PPQ1 / CH:PPQ2 PPQm CH:PPQ4 Mobile Privacy Policy Bundle Feed Policy Repository Policy Source CH:PPQ1 / CH:PPQ2 PPQm CH:PPQ5 Mobile Privacy Policy Retrieve Policy Repository Policy Source CH:PPQ2 <p>For Authentication/Authorization you have two different options:</p> <ol> <li>Integrate the IdP into your software and exchange the IdP saml2 token over a REST API to a XUA token link</li> <li>Configure the IdP's with the Mobile Access Gateway and use an OAuth token (in development)</li> </ol>"},{"location":"features/#ch-epr-constraints","title":"CH EPR Constraints","text":"<p>The Swiss EPR defines contraints on the use of MHD, PIXm, PDQm and PPQm transactions. Those can be enabled in the  configuration file: <pre><code>mag:\n  ch-epr-fhir:\n    ch-mhd-constraints: true\n    ch-ppqm-constraints: true\n    ch-pixm-constraints: true\n    ch-pdqm-constraints: true\n</code></pre></p> <p>Furthermore, the parameter <code>mag.ch-epr-fhir.epr-spid-as-patientid</code> allows to set the patient EPR-SPID as the FHIR  Patient id. The mapping will automatically be changed to support that.</p>"},{"location":"integration-primary-system/","title":"EPR Primary System Integration","text":"<p>The REST variants of XDS transactions presented here are based on CH EPR mHealth, itself based on various IHE profiles.</p> <p> Don't forget to properly encode the HTTP parameters in the queries (especially colons and pipes). In the following examples, they are shown decoded for a better readability. <code>Authorization</code> and <code>Accept</code> headers are not shown in the examples.</p> <p> For HTTP GET requests, there is usually an equivalent HTTP POST request that should be supported.</p>"},{"location":"integration-primary-system/#authentication","title":"Authentication","text":"<p>The sequence diagram shows the currently implemented authentication flow.</p> <p>You should integrate one of the supported IDPs in your application. The OAuth/IUA flow is supported for clients, the SAML flow is the only one implemented between the  MobileAccessGateway and the IDP.</p> <p>Once you get the IDP SAML assertion, you can trade it for the community SAML assertion, which binds your IDP identification to a specific patient and a purpose of use. It is an HTTP POST request to <code>/assertion</code>, with the header <code>Scope</code> and the IDP SAML assertion as body. The header <code>Scope</code> contains the following values:</p> <ul> <li><code>purpose_of_use</code> (token, required): a value from EprPurposeOfUse.</li> <li><code>subject_role</code> (token, required): either <code>HCP</code>, <code>ASS</code>, <code>PAT</code> or <code>REP</code> in the system <code>urn:oid:2.16.756.5.30.1.127.3.10.6</code>.</li> <li><code>person_id</code> (string, required): the patient EPR-SPID in the CX format.</li> <li><code>principal</code> (string, only if role is ASS): the name of the healthcare professional an assistant is acting on   behalf of.</li> <li><code>principal_id</code> (token, only if role is ASS): the GLN of the healthcare professional an assistant is acting on   behalf of.</li> <li><code>group</code> (string, only if role is ASS): the name of the organization or group an assistant is acting on   behalf of.</li> <li><code>group_id</code> (token, only if role is ASS): the OID of the organization or group an assistant is acting on   behalf of.</li> </ul> Request<pre><code>POST /assertion HTTP/1.1\nScope: person_id=761337610445502987^^^&amp;2.16.756.5.30.1.127.3.10.3&amp;ISO purpose_of_use=urn:oid:2.16.756.5.30.1.127.3.10.5|NORM subject_role=urn:oid:2.16.756.5.30.1.127.3.10.6|HCP\nContent-Type: application/xml\n\n&lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\"&gt;\n&lt;!-- Content of the IDP assertion\u2026 --&gt;\n&lt;/saml2:Assertion&gt;\n</code></pre> <p>The response then looks like:</p> Response<pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n\"access_token\": \"U0FNTGFzc2VydGlvbg\",\n\"token_type\": \"IHE-SAML\",\n\"expires_in\": 60000,\n\"scope\": \"resourceId/761337610445502987 purposeOfUse/NORM role/HCP\"\n}\n</code></pre> <p>The base64-url encoded SAML assertion is given in <code>access_token</code>, and that value has to be prefixed with <code>Bearer</code> and inserted in an <code>Authorization</code> HTTP header for all transactions that requires it.</p> Example of request with the XUA<pre><code>GET /... HTTP/1.1\nAuthorization: Bearer U0FNTGFzc2VydGlvbg\n</code></pre>"},{"location":"integration-primary-system/#patient-directory","title":"Patient directory","text":"<p>The patient directory (called MPI) contains identifiers and demographics for all registered patients. Identifiers include the MPI-PID and EPR-SPID, and identifiers used by primary systems that choose to share them. Demographics include the given and family names, date of birth, gender, nationality and telecoms. It can be queried and updated.</p>"},{"location":"integration-primary-system/#retrieving-patient-identifiers","title":"Retrieving patient identifiers","text":"<p>Patient identifiers (commonly the MPI-PID and EPR-SPID) can be queried with an ITI-83 (Mobile Patient Identifier Cross-reference Query) transaction.</p> <p>The transaction is an HTTP GET request to the endpoint <code>/Patient/$ihe-pix</code>, with the following parameters:</p> <ol> <li>sourceIdentifier (token, mandatory): the known patient identifier</li> <li>targetSystem (uri, optional): to restrict the results to the MPI-PID and/or EPR-SPID.</li> </ol> Examples To retrieve all known identifiers from a local identifier ('1234' in the system 2.999.42)<pre><code>GET /Patient/$ihe-pix?sourceIdentifier=urn:oid:2.999.42|1234 HTTP/1.1\n</code></pre> To retrieve the EPR-SPID from the MPI-PID<pre><code>GET /Patient/$ihe-pix?sourceIdentifier=urn:oid:2.16.756.5.30.1.191.1.0.12.3.101|{mpi-pid}&amp;targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#retrieving-patient-demographics","title":"Retrieving patient demographics","text":"<p>Patient demographics can be queried with an ITI-78 (Mobile Patient Demographics Query) transaction.</p> <p>The transaction can be done in two ways, either by specifying the MPI-PID to retrieve a single patient, or by specifying other information.</p> With the MPI-PIDWith other information <p>If the MPI-PID is known, the transaction is an HTTP GET request to the endpoint <code>/Patient/{id}</code>, where {id} is the system OID and the identifier value, separated by a dash.</p> Retrieve by MPI-PID<pre><code>GET /Patient/2.16.756.5.30.1.191.1.0.2.1-e7963774-9098-445f-9cab-5d52234b52c3 HTTP/1.1\n</code></pre> Retrieve by EPR-SPID<pre><code>GET /Patient/2.16.756.5.30.1.127.3.10.3-761337615866818761 HTTP/1.1\n</code></pre> <p>Otherwise, parameters can be used to search patients with other information:</p> <ul> <li><code>family</code> and <code>given</code> (string)</li> <li><code>identifier</code> (token)</li> <li><code>telecom</code> (token)</li> <li><code>birthdate</code> (date)</li> <li><code>address</code> (string): to search in any part of the address.</li> <li><code>address-city</code>,   <code>address-country</code>,   <code>address-postalcode</code>,   <code>address-state</code> (string)</li> <li><code>gender</code> (token)</li> </ul> Example<pre><code>GET /Patient?family=MOHR&amp;given=ALICE&amp;gender=female HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#feeding-patient-information","title":"Feeding patient information","text":"<p>Feeding patient information can be done with the ITI-104 (Patient Identity Feed FHIR) transaction. The following profile shall be used: <code>http://fhir.ch/ig/ch-epr-mhealth/StructureDefinition-ch-pixm-patient.html</code>.</p> <p>The MPI-PID is required in <code>identifier</code>. You don't have to re-specify the other identifiers, they won't be deleted if they're missing from the request. If you want to add an identifier, you can put it in <code>identifier</code>.</p> Examples Add an identifier<pre><code>PUT /Patient?identifier=urn:oid:2.16.756.5.30.1.196.3.2.1|MAGMED001 HTTP/1.1\nContent-Type: application/fhir+json\n\n{\n\"active\": true,\n\"birthDate\": \"1987-10-08\",\n\"gender\": \"male\",\n\"id\": \"2.16.756.5.30.1.127.3.10.3-761337611735842172\",\n\"identifier\": [\n{\n\"system\": \"urn:oid:2.16.756.5.30.1.196.3.2.1\",\n\"value\": \"MAGMED001\"\n},\n{\n\"system\": \"urn:oid:2.999.42\",\n\"value\": \"new-identifier-value\"\n}\n],\n\"name\": [\n{\n\"family\": \"NEFF-WINGEIER\",\n\"given\": [\n\"Trong Sang\"\n]\n}\n],\n\"resourceType\": \"Patient\"\n}\n</code></pre>"},{"location":"integration-primary-system/#document-directory","title":"Document directory","text":"<p>The document directory stores documents (in the document repository) and their metadata (in the document registry).</p>"},{"location":"integration-primary-system/#searching","title":"Searching","text":"<p>You can search the document registry with the ITI-67 (Find Document References) transaction.</p> <p>The transaction is an HTTP GET request to the endpoint <code>/DocumentReference</code>, the search parameters are described in the MHD ITI-67 specifications.</p> Examples Search all documents from a patient<pre><code>GET /DocumentReference?patient.identifier=urn:oid:2.999|11111111&amp;status=current HTTP/1.1\n</code></pre> Search by class and type codes<pre><code>GET /DocumentReference?patient.identifier=urn:oid:2.999|11111111&amp;category=http://snomed.info/sct|371531000&amp;type=http://snomed.info/sct|419891008 HTTP/1.1\n</code></pre> Search by creation date<pre><code>GET /DocumentReference?patient.identifier=urn:oid:2.999|11111111&amp;creation=ge2023-07-10&amp;creation=le2023-07-17 HTTP/1.1\n</code></pre> <p>You can also search for SubmissionSets with the ITI-66 (Find Document Lists) transaction.</p> Examples Search all by patient identifier<pre><code>GET /List?patient.identifier=urn:oid:2.999|11111111 HTTP/1.1\n</code></pre> Search with additional parameters<pre><code>GET /List?patient.identifier=urn:oid:2.999|11111111&amp;code=submissionset&amp;status=current&amp;designationType=http://loinc.org|1234-5 HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#reading","title":"Reading","text":"<p>Retrieving a document is done with the ITI-68 (Retrieve Document) transaction. It is a simple HTTP GET request to a URL that you will find in the linked DocumentReference (that you can obtain with search results): <code>DocumentReference.content.attachment.url</code>.</p>"},{"location":"integration-primary-system/#publishing","title":"Publishing","text":"<p>You can publish a document with the ITI-65 (Provide Document Bundle) transaction.</p> <p>The transaction is an HTTP POST request to the endpoint <code>/</code>. The following profile shall be used: <code>https://profiles.ihe.net/ITI/MHD/StructureDefinition/IHE.MHD.Comprehensive.ProvideBundle</code>.</p> Examples Publish a PDF file<pre><code>POST / HTTP/1.1\nContent-Type: application/fhir+json;charset=UTF-8\n\n{\n\"entry\": [\n{\n\"fullUrl\": \"urn:uuid:59f3a738-11c1-4a0e-a89b-c4552d0fe9a7\",\n\"request\": {\n\"method\": \"POST\",\n\"url\": \"Binary\"\n},\n\"resource\": {\n\"contentType\": \"application/pdf\",\n\"data\": \"VGhlIHBkZiBmaWxlIGdvZXMgaGVyZQ==\",\n\"resourceType\": \"Binary\"\n}\n},\n{\n\"fullUrl\": \"urn:uid:eb00c215-61cf-43a3-b99a-020ab21828fa\",\n\"request\": {\n\"method\": \"POST\",\n\"url\": \"List\"\n},\n\"resource\": {\n\"code\": {\n\"coding\": [\n{\n\"code\": \"submissionset\",\n\"display\": \"SubmissionSet as a FHIR List\",\n\"system\": \"http://profiles.ihe.net/ITI/MHD/CodeSystem/MHDlistTypes\"\n}\n]\n},\n\"date\": \"2023-01-06T14:23:14+01:00\",\n\"entry\": [\n{\n\"item\": {\n\"reference\": \"urn:uuid:5ae558f6-c103-4566-9a7e-63242abd24ab\"\n}\n}\n],\n\"extension\": [\n{\n\"url\": \"http://profiles.ihe.net/ITI/MHD/StructureDefinition/ihe-sourceId\",\n\"valueIdentifier\": {\n\"value\": \"urn:oid:2.16.756.5.30.1.145.20.1\"\n}\n},\n{\n\"url\": \"http://fhir.ch/ig/ch-epr-mhealth/StructureDefinition/ch-ext-author-authorrole\",\n\"valueCoding\": {\n\"code\": \"HCP\",\n\"display\": \"Healthcare professional\",\n\"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.6\"\n}\n},\n{\n\"url\": \"http://profiles.ihe.net/ITI/MHD/StructureDefinition/ihe-designationType\",\n\"valueCodeableConcept\": {\n\"coding\": [\n{\n\"code\": \"71388002\",\n\"display\": \"Procedure (procedure)\",\n\"system\": \"http://snomed.info/sct\"\n}\n],\n\"text\": \"Procedure (procedure)\"\n}\n}\n],\n\"identifier\": [\n{\n\"system\": \"urn:ietf:rfc:3986\",\n\"use\": \"official\",\n\"value\": \"urn:uuid:ab1862da-e31e-4ca9-ab01-24883cda5404\"\n},\n{\n\"system\": \"urn:ietf:rfc:3986\",\n\"use\": \"usual\",\n\"value\": \"urn:oid:2.999.123\"\n}\n],\n\"mode\": \"working\",\n\"resourceType\": \"List\",\n\"status\": \"current\",\n\"subject\": {\n\"reference\": \"Patient/2.16.756.5.30.1.191.1.0.2.1-c55f4ca7-bd4e-4134-8dcd-56b793ade958\"\n}\n}\n},\n{\n\"fullUrl\": \"urn:uuid:5ae558f6-c103-4566-9a7e-63242abd24ab\",\n\"request\": {\n\"method\": \"POST\",\n\"url\": \"DocumentReference\"\n},\n\"resource\": {\n\"author\": [\n{\n\"reference\": \"#practrole\"\n}\n],\n\"category\": [\n{\n\"coding\": [\n{\n\"code\": \"405624007\",\n\"display\": \"Administrative documentation (record artifact)\",\n\"system\": \"http://snomed.info/sct\"\n}\n]\n}\n],\n\"contained\": [\n{\n\"birthDate\": \"1993-01-27\",\n\"gender\": \"male\",\n\"id\": \"1\",\n\"identifier\": [\n{\n\"system\": \"urn:oid:2.16.756.5.30.1.191.1.0.12.3.101\",\n\"value\": \"MAGMED006\"\n},\n{\n\"system\": \"urn:oid:2.16.756.5.30.1.191.1.0.2.1\",\n\"value\": \"c55f4ca7-bd4e-4134-8dcd-56b793ade958\"\n}\n],\n\"name\": [\n{\n\"family\": \"Seszt\u00e1kov\u00e1\",\n\"given\": [\n\"Jett Flynn\"\n]\n},\n{\n\"family\": \"Seszt\u00e1kov\u00e1\",\n\"given\": [\n\"Jett Flynn\"\n]\n}\n],\n\"resourceType\": \"Patient\"\n},\n{\n\"address\": [\n{\n\"city\": \"Z\u00fcrich\",\n\"country\": \"CH\",\n\"line\": [\n\"Krankenstrasse 2\"\n],\n\"postalCode\": \"8005\"\n}\n],\n\"id\": \"org\",\n\"identifier\": [\n{\n\"system\": \"urn:oid:2.51.1.3\",\n\"value\": \"7601000234438\"\n}\n],\n\"name\": \"Hausarzt\",\n\"resourceType\": \"Organization\"\n},\n{\n\"id\": \"pract\",\n\"identifier\": [\n{\n\"system\": \"urn:oid:2.51.1.3\",\n\"value\": \"7601000234438\"\n}\n],\n\"name\": [\n{\n\"family\": \"Hausarzt\",\n\"given\": [\n\"Familien\"\n]\n}\n],\n\"resourceType\": \"Practitioner\"\n},\n{\n\"id\": \"practrole\",\n\"organization\": {\n\"reference\": \"#org\"\n},\n\"practitioner\": {\n\"reference\": \"#pract\"\n},\n\"resourceType\": \"PractitionerRole\"\n}\n],\n\"content\": [\n{\n\"attachment\": {\n\"contentType\": \"application/pdf\",\n\"creation\": \"2011-11-29T11:00:00+01:00\",\n\"language\": \"de-CH\",\n\"url\": \"urn:uuid:59f3a738-11c1-4a0e-a89b-c4552d0fe9a7\",\n\"title\": \"Document example title\"\n},\n\"format\": {\n\"code\": \"urn:che:epr:EPR_Unstructured_Document\",\n\"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.10\"\n}\n}\n],\n\"context\": {\n\"facilityType\": {\n\"coding\": [\n{\n\"code\": \"264358009\",\n\"display\": \"General practice premises(environment)\",\n\"system\": \"http://snomed.info/sct\"\n}\n]\n},\n\"practiceSetting\": {\n\"coding\": [\n{\n\"code\": \"394802001\",\n\"display\": \"General medicine(qualifier value)\",\n\"system\": \"http://snomed.info/sct\"\n}\n]\n},\n\"sourcePatientInfo\": {\n\"reference\": \"#1\"\n}\n},\n\"date\": \"2011-11-29T11:00:00+01:00\",\n\"description\": \"file.pdf\",\n\"extension\": [\n{\n\"url\": \"http://fhir.ch/ig/ch-epr-mhealth/StructureDefinition/ch-ext-author-authorrole\",\n\"valueCoding\": {\n\"code\": \"HCP\",\n\"display\": \"Healthcare professional\",\n\"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.6\"\n}\n}\n],\n\"identifier\": [\n{\n\"system\": \"urn:ietf:rfc:3986\",\n\"use\": \"usual\",\n\"value\": \"urn:oid:2.25.161286146254585515369612173924762763705\"\n}\n],\n\"masterIdentifier\": {\n\"value\": \"urn:uuid:f3b905a6-f0e4-4ba6-9b6e-c7e7692c0438\"\n},\n\"resourceType\": \"DocumentReference\",\n\"securityLabel\": [\n{\n\"coding\": [\n{\n\"code\": \"17621005\",\n\"display\": \"Normally accessible\",\n\"system\": \"http://snomed.info/sct\"\n}\n]\n}\n],\n\"status\": \"current\",\n\"subject\": {\n\"reference\": \"Patient/2.16.756.5.30.1.191.1.0.2.1-c55f4ca7-bd4e-4134-8dcd-56b793ade958\"\n},\n\"type\": {\n\"coding\": [\n{\n\"code\": \"772786005\",\n\"display\": \"Medical certificate (record artifact)\",\n\"system\": \"http://snomed.info/sct\"\n}\n]\n}\n}\n}\n],\n\"meta\": {\n\"profile\": [\n\"http://profiles.ihe.net/ITI/MHD/StructureDefinition/IHE.MHD.Comprehensive.ProvideBundle\"\n]\n},\n\"resourceType\": \"Bundle\",\n\"type\": \"transaction\"\n}\n</code></pre>"},{"location":"integration-primary-system/#professional-and-organization-directory","title":"Professional and organization directory","text":"<p>The HPD (Healthcare Provider Directory) contains information about the healthcare professionals and organizations that are part of the EPR. Relationships between them (i.e. membership of professionals to organizations, or relationships between organizations) are also available.</p>"},{"location":"integration-primary-system/#searching_1","title":"Searching","text":"<p>Professionals, organizations and relationships can be queried with an ITI-90 (Find Matching Care Services) transaction. See the specifications for the complete list of search parameters.</p> ProfessionalsOrganizationsRelationships <p>For professionals, the endpoint is <code>/Practitioner</code>.</p> Search for 'M\u00fcller'<pre><code>GET /Practitioner?family=M\u00fcller HTTP/1.1\n</code></pre> Search by GLN<pre><code>GET /Practitioner?identifier=urn:oid:2.51.1.3|7601000102737 HTTP/1.1\n</code></pre> Retrieve from identifier<pre><code>GET /Practitioner/DrPeterPan HTTP/1.1\n</code></pre> <p>For organizations, the endpoint is <code>/Organization</code>.</p> Search for active Organization whose name contains 'Medical'<pre><code>GET /Organization?active=true&amp;name:contains=Medical HTTP/1.1\n</code></pre> Retrieve from identifier<pre><code>GET /Organization/SpitalXDept3 HTTP/1.1\n</code></pre> <p>For relationships (memberships), the endpoint is <code>/PractitionerRole</code>.</p> Search for all professionals working at the 'HUG' organization<pre><code>GET /PractitionerRole?organization=Organization/HUG&amp;_include=PractitionerRole:practitioner HTTP/1.1\n</code></pre> Retrieve from identifier<pre><code>GET /PractitionerRole/PeterPanPraxisP HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#updating","title":"Updating","text":"<p>The HPD update is not supported in a REST transaction. Please use the ITI-59 (Provider Information Feed) transaction.</p>"},{"location":"integration-primary-system/#audit-messages","title":"Audit messages","text":""},{"location":"integration-primary-system/#creating","title":"Creating","text":"<p>For all transactions, it is required to send the same audit messages. You can use the regular ITI-20 transaction, or use the restful one.</p> <p>See the mapping from DICOM to FHIR.</p> Examples <pre><code>POST /ARR/fhir/AuditEvent HTTP/1.1\nContent-Type: application/fhir+xml\n\n&lt;Bundle&gt;\n&lt;entry&gt;\n...\n    &lt;request&gt;\n&lt;method value=\"POST\"/&gt;\n&lt;/request&gt;\n&lt;/entry&gt;\n&lt;/Bundle&gt;\n</code></pre>"},{"location":"integration-primary-system/#reading_1","title":"Reading","text":"<p>You can read the audit messages for a given patient with an ITI-81 transaction.</p> <p>Warning</p> <p>The endpoint for this transaction is the EPR community itself, not the Mobile Access Gateway. This transaction is still implemented on a previous CH:ATC specification (March 2020), based on the IHE Restful ATNA supplement rev. 2.2. A lot have changed since.</p> <p>The transaction is an HTTP GET request on the endpoint, with the parameter <code>entity-id</code> that contain the patient EPR-SPID, and <code>date</code> to constraint the audit message date. The <code>Authorization</code> header uses the prefix <code>IHE-SAML</code> and the SAML assertion is encoded with the regular base64 alphabet.</p> <p>The community will ask other communities for their audit messages and regroup them all. If a foreign community is not reachable, an OperationOutcome may be added to the response Bundle.</p> Examples <pre><code>GET /ARR/fhir/AuditEvent?entity-id=urn:oid:2.16.756.5.30.1.127.3.10.3|{epr-spid}&amp;date=ge2023-07-10&amp;date=le2023-07-17 HTTP/1.1\nAuthorization: IHE-SAML Zm9vYmE=\n</code></pre>"}]}